<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Getting Started Guide</title>
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header>

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills'>
          <li>
            <a class='btn btn-link btn-lg' href="/blog/index.html">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/daleharvey/pouchdb/releases/download/2.2.3/pouchdb-2.2.3.min.js"
            >
                Download <strong>v2.2.3</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1>Getting Started Guide</h1>
          

        </div>

      </div>
    


    <article>
  <div class="container">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
          <div data-spy="affix" data-offset-top="214" data-offset-bottom="450">
            <ul class="nav nav-silent nav-sidebar">
              <li><a href="/learn.html">About PouchDB</a></li>
<li><a href="/getting-started.html">Get Started Guide</a></li>
<li><a href="/api.html">API</a></li>
<li><a href="/adapters.html">Adapters</a></li>
<li><a href="/faq.html">FAQ</a></li>
<li><a href="/errors.html">Common Errors</a></li>
<li><a href="/external.html">External Projects</a></li>

            </ul>
          </div>
        </div>

        <div class="col-sm-9">
          <p>In this tutorial we will write a basic Todo web application based on <a href="http://todomvc.com/">TodoMVC</a> that syncs to an online CouchDB server. It should take around 10 minutes.</p>

<div id='download'>
  <a
     class='h3 anchor'
     href='#download'
     name='download'
  >
    Download Assets
  </a>
</div>

<p>We will start with a template of the project where all the data related functions have been replaced with empty stubs. Download and unzip <a href="/static/assets/pouchdb-getting-started-todo.zip">pouchdb-getting-started-todo.zip</a>. When dealing with XHR and IndexedDB you are better off running web pages from a server as opposed to a filesystem. To do this you can run:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd </span>pouchdb-getting-started-todo
<span class="nv">$ </span>python -m SimpleHTTPServer</code></pre></div>


Then visit [http://127.0.0.1:8000/](http://127.0.0.1:8000/). If you see the following screenshot, you are good to go:

<a href="/static/img/screenshots/todo-1.png" style="display: block; text-align: center;">
   <img src="/static/img/screenshots/todo-1.png" style="width:400px;"/>
</a>

It's also a good idea to open your browser's console so you can see any errors or confirmation messages.


  

<div id='installing_pouchdb'>
  <a
     class='h3 anchor'
     href='#installing_pouchdb'
     name='installing_pouchdb'
  >
    Installing PouchDB
  </a>
</div>

<p>Open <code>index.html</code> and include PouchDB in the app by adding a script tag:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;//cdn.jsdelivr.net/pouchdb/2.2.3/pouchdb.min.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/base.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;js/app.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></div>


PouchDB is now installed in your app and ready to use! (In production, you should use a local copy of the script.)


  

<div id='creating_a_database'>
  <a
     class='h3 anchor'
     href='#creating_a_database'
     name='creating_a_database'
  >
    Creating a database
  </a>
</div>

<p>The rest of the work will be done inside <code>app.js</code>. We will start by creating a database to enter your todos. To create a database simply instantiate a new PouchDB object with the name of the database:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// EDITING STARTS HERE (you dont need to edit anything above this line)</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;todos&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">remoteCouch</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></code></pre></div>


You don't need to create a schema for the database. After giving it a name, you can immediately start writing objects to it.


  

<div id='write_todos_to_database'>
  <a
     class='h3 anchor'
     href='#write_todos_to_database'
     name='write_todos_to_database'
  >
    Write todos to the database
  </a>
</div>

<p>The first thing we shall do is start writing items to the database. The main input will call <code>addTodo</code> with the current text when the user presses <code>Enter</code>. We can complete this function with the following code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">addTodo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">todo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
    <span class="nx">title</span><span class="o">:</span> <span class="nx">text</span><span class="p">,</span>
    <span class="nx">completed</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">todo</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Successfully posted a todo!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></div>


In PouchDB each document is required to have a unique `_id`. Any subsequent writes to a document with the same `_id` will be considered updates. Here we are using a date string as an `_id`. For our use case, it will be unique, and it can also be used to sort items in the database. You can use `db.post()` if you want random ids. The `_id` is the only thing required when creating a new document. The rest of the object you can create as you like.

The `callback` function will be called once the document has been written (or failed to write). If the `err` argument is not null, then it will have an object explaining the error, otherwise the `result` will hold the result.


  

<div id='show_database_items'>
  <a
     class='h3 anchor'
     href='#show_database_items'
     name='show_database_items'
  >
    Show items from the database
  </a>
</div>

<p>We have included a helper function <code>redrawTodosUI</code> that takes an array of todos to display, so all we need to do is read the todos from the database. Here we will simply read all the documents using <code>db.allDocs</code>. The <code>include_docs</code> option tells PouchDB to give us the data within each document, and the <code>descending</code> option tells PouchDB how to order the results based on their <code>_id</code> field, giving us newest first.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">showTodos</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">descending</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">redrawTodosUI</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></div>


Once you have included this code, you should be able to refresh the page to see any todos you have entered.


  

<div id='update_the_ui'>
  <a
     class='h3 anchor'
     href='#update_the_ui'
     name='update_the_ui'
  >
    Update the UI
  </a>
</div>

<p>We dont want to refresh the page to see new items. More typically you would update the UI manually when you write data to it, however, in PouchDB you may be syncing data remotely, so you want to make sure you update whenever the remote data changes. To do this we will call <code>db.changes</code> which subscribes to updates to the database, wherever they come from. You can enter this code between the <code>remoteCouch</code> and <code>addTodo</code> declaration:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">remoteCouch</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
    <span class="nx">since</span><span class="o">:</span> <span class="nx">info</span><span class="p">.</span><span class="nx">update_seq</span><span class="p">,</span>
    <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">showTodos</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// We have to create a new todo document and enter it in the database</span>
<span class="kd">function</span> <span class="nx">addTodo</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span></code></pre></div>


So every time an update happens to the database, we redraw the UI to show the new data. The `live` flag means this function will continue to run indefinitely. Now try entering a new todo and it should appear immediately.


  

<div id='edit_a_todo'>
  <a
     class='h3 anchor'
     href='#edit_a_todo'
     name='edit_a_todo'
  >
    Edit a todo
  </a>
</div>

<p>When the user checks a checkbox, the <code>checkboxChanged</code> function will be called, so we&#39;ll fill in the code to edit the object and call <code>db.put</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">checkboxChanged</span><span class="p">(</span><span class="nx">todo</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">todo</span><span class="p">.</span><span class="nx">completed</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>


This is similiar to creating a document, however the document must also contain a `_rev` field (in addition to `_id`), otherwise the write will be rejected. This ensures that you dont accidently overwrite changes to a document.

You can test that this works by checking a todo item and refreshing the page. It should stay checked.


  

<div id='delete_an_object'>
  <a
     class='h3 anchor'
     href='#delete_an_object'
     name='delete_an_object'
  >
    Delete an object
  </a>
</div>

<p>To delete an object you can call db.remove with the object.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">deleteButtonPressed</span><span class="p">(</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>


Similiar to editing a document, both the `_id` and `_rev` properties are required. You may notice that we are passing around the full object that we previously read from the database. You can of course manually construct the object, like: `{_id: todo._id, _rev: todo._rev}`, but passing around the existing object is usually more convenient and less error prone.


  

<div id='complete_todo_ui'>
  <a
     class='h3 anchor'
     href='#complete_todo_ui'
     name='complete_todo_ui'
  >
    Complete rest of the Todo UI
  </a>
</div>

<p><code>todoBlurred</code> is called when the user edits a document. Here we&#39;ll delete the document if the user has entered a blank title, and we&#39;ll update it otherwise.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">todoBlurred</span><span class="p">(</span><span class="nx">todo</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">trimmedText</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">trimmedText</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">trimmedText</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">todo</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>



  

<div id='installing_couchdb'>
  <a
     class='h3 anchor'
     href='#installing_couchdb'
     name='installing_couchdb'
  >
    Installing CouchDB
  </a>
</div>

<p>Now we&#39;ll implement the syncing. You need to have a CouchDB instance, which you can either install yourself <a href="http://couchdb.apache.org/">CouchDB(1.3+) locally</a> or use with an online provider like <a href="http://iriscouch.com">IrisCouch</a>.</p>

<div id='enabling_cors'>
  <a
     class='h3 anchor'
     href='#enabling_cors'
     name='enabling_cors'
  >
    Enabling CORS
  </a>
</div>

<p>To replicate directly with CouchDB, you need to make sure CORS is enabled. Only set the username and password if you have set them previously. By default, CouchDB will be installed in &quot;Admin Party,&quot; where username and password are not needed. You will need to replace <code>myname.iriscouch.com</code> with your own host (<code>127.0.0.1:5984</code> if installed locally):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">export </span><span class="nv">HOST</span><span class="o">=</span>http://username:password@myname.iriscouch.com
<span class="nv">$ </span>curl -X PUT <span class="nv">$HOST</span>/_config/httpd/enable_cors -d <span class="s1">&#39;&quot;true&quot;&#39;</span>
<span class="nv">$ </span>curl -X PUT <span class="nv">$HOST</span>/_config/cors/origins -d <span class="s1">&#39;&quot;*&quot;&#39;</span>
<span class="nv">$ </span>curl -X PUT <span class="nv">$HOST</span>/_config/cors/credentials -d <span class="s1">&#39;&quot;true&quot;&#39;</span>
<span class="nv">$ </span>curl -X PUT <span class="nv">$HOST</span>/_config/cors/methods -d <span class="s1">&#39;&quot;GET, PUT, POST, HEAD, DELETE&quot;&#39;</span>
<span class="nv">$ </span>curl -X PUT <span class="nv">$HOST</span>/_config/cors/headers -d <span class="se">\</span>
  <span class="s1">&#39;&quot;accept, authorization, content-type, origin, referer&quot;&#39;</span></code></pre></div>



  

<div id='basic_two_way_sync'>
  <a
     class='h3 anchor'
     href='#basic_two_way_sync'
     name='basic_two_way_sync'
  >
    Implement basic two way sync
  </a>
</div>

<p>Now we will have the todo list sync. Back in <code>app.js</code> we need to specify the address of the remote database. Remember to replace <code>user</code>, <code>pass</code> and <code>myname.iriscouch.com</code> with the credentials of your own CouchDB instance:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// EDITING STARTS HERE (you dont need to edit anything above this line)</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;todos&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">remoteCouch</span> <span class="o">=</span> <span class="s1">&#39;http://user:pass@mname.iriscouch.com/todos&#39;</span><span class="p">;</span></code></pre></div>


Then we can implement the sync function like so:


<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">sync</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">syncDom</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">&#39;data-sync-state&#39;</span><span class="p">,</span> <span class="s1">&#39;syncing&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span><span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">};</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remoteCouch</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">syncError</span><span class="p">);</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">remoteCouch</span><span class="p">,</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">syncError</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>


`db.replicate()` tells PouchDB to transfer all the documents `to` or `from` the `remoteCouch`. This can either be a string identifier or a PouchDB object. We call this twice: once to receive remote updates, and once to push local changes. Again, the `live` flag is used to tell PouchDB to carry on doing this indefinitely. The callback will be called whenever this finishes. For live replication, this will mean an error has occured, like losing your connection or you canceled the replication.

You should be able to open [the todo app](http://127.0.0.1:8000) in another browser and see that the two lists stay in sync with any changes you make to them. You may also want to look at your CouchDB's Futon administration page and see the populated database.


  

<div id='congratulations'>
  <a
     class='h3 anchor'
     href='#congratulations'
     name='congratulations'
  >
    Congratulations!
  </a>
</div>

<p>You&#39;ve completed your first PouchDB application. This is a basic example, and a real world application will need to integrate more error checking, user signup, etc. But you should now understand the basics you need to start working on your own PouchDB project. If you have any more questions, please get in touch on <a href="irc://freenode.net#pouchdb">IRC</a> or the <a href="https://groups.google.com/forum/#!forum/pouchdb">mailing list</a>.</p>

        <div>

    </div>

  </div>

</article>


    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb'>
              <div class="icon icon-twitter"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://www.browserstack.com/'>
              <div class="icon icon-browserstack"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb'>
              <div class="icon icon-github"></div>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb'>
              <div class="icon icon-travis"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/'>
              <div class="icon icon-couchdb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com'>
              <div class="icon icon-saucelabs"></div>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/daleharvey/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb">Source</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>
