<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>API Reference</title>
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header>

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills'>
          <li>
            <a class='btn btn-link btn-lg' href="/blog/">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/guides/">Guides</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/daleharvey/pouchdb/releases/download/3.0.5/pouchdb-3.0.5.min.js"
            >
                Download <strong>v3.0.5</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1>API Reference</h1>
          

        </div>

      </div>
    


    <article>
  <div class="container">
    <div class="row">
        <div id="sidebar" class="col-sm-3">
          <div data-spy="affix" data-offset-top="214" data-offset-bottom="450">
            <ul class="nav nav-silent nav-sidebar">
              <li><a href="#create_database">Create database</a></li>
<li><a href="#delete_database">Delete database</a></li>
<li><a href="#create_document">Create/update doc</a></li>
<li><a href="#fetch_document">Fetch doc</a></li>
<li><a href="#delete_document">Delete doc</a></li>
<li><a href="#batch_create">Batch create</a></li>
<li><a href="#batch_fetch">Batch fetch</a></li>
<li><a href="#changes">Changes</a></li>
<li><a href="#replication">Replication</a></li>
<li><a href="#sync">Sync</a></li>
<li><a href="#save_attachment">Save attachment</a></li>
<li><a href="#get_attachment">Get attachment</a></li>
<li><a href="#delete_attachment">Delete attachment</a></li>
<li><a href="#query_database">Query database</a></li>
<li><a href="#view_cleanup">View cleanup</a></li>
<li><a href="#database_information">Database info</a></li>
<li><a href="#compaction">Compaction</a></li>
<li><a href="#revisions_diff">Revision diff</a></li>
<li><a href="#events">Events</a></li>
<li><a href="#defaults">Default settings</a></li>
<li><a href="#plugins">Plugins</a></li>

            </ul>
          </div>
        </div>

        <div class="col-sm-9">
          <p>Most of the PouchDB API is exposed as <code>fun(arg, [options], [callback])</code> where both the options and the callback are optional. Callbacks use the <code>function(err, result)</code> idiom where the first argument will be undefined unless there is an error, and the second argument holds the result. </p>

<p>Additionally, any method that only returns a single thing (e.g. <code>db.get</code>) also returns a <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">promise</a>. Promises come from the minimal library <a href="https://github.com/calvinmetcalf/lie">lie</a> in the browser, and the feature-rich <a href="https://github.com/petkaantonov/bluebird">Bluebird</a> in Node.</p>

<div id='create_database'></div>

<p><a class='h2 anchor' href='#create_database' name='create_database'>Create a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">new</span> <span class="nx">PouchDB</span><span class="p">([</span><span class="nx">name</span><span class="p">],</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>This method creates a database or opens an existing one. If you use a URL like <code>&#39;http://domain.com/dbname&#39;</code> then PouchDB will work as a client to an online CouchDB instance.  Otherwise it will create a local database using whatever backend is present (i.e. IndexedDB, WebSQL, or LevelDB). </p>

<h3>Options</h3>

<ul>
<li><code>options.name</code>: You can omit the <code>name</code> argument and specify it via <code>options</code> instead. Note that the name is required.</li>
<li><code>options.auto_compaction</code>: This turns on auto compaction, which means <code>compact()</code> is called after every change to the database. Defaults to <code>false</code>.</li>
<li><code>options.adapter</code>: One of <code>&#39;idb&#39;</code>, <code>&#39;leveldb&#39;</code>, <code>&#39;websql&#39;</code>, or <code>&#39;http&#39;</code>. If unspecified, PouchDB will infer this automatically, preferring IndexedDB to WebSQL in browsers that support both (i.e. Chrome, Opera and Android 4.4+).</li>
<li><code>options.ajax</code>: An object of options to be sent to the ajax requester. In Node they are sent verbatim to <a href="https://github.com/mikeal/request">request</a> with the exception of:

<ul>
<li><code>options.ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
</ul></li>
</ul>

<p><strong>Notes:</strong> </p>

<ol>
<li>In IndexedDB and WebSQL, PouchDB will use <code>_pouch_</code> to prefix the internal database names. Do not manually create databases with the same prefix.</li>
<li>When acting as a client on Node, any other options given will be passed to <a href="https://github.com/mikeal/request">request</a>.</li>
<li>When using the <code>&#39;leveldb&#39;</code> adapter (the default on Node), any other options given will be passed to <a href="https://github.com/rvagg/node-levelup">levelup</a>. The storage layer of leveldb can be replaced by passing a level backend factory (such as <a href="https://github.com/rvagg/memdown">MemDOWN</a>) as <code>options.db</code>. The rest of the supported options are <a href="https://github.com/rvagg/node-levelup/#options">documented here</a>.</li>
<li>When using the <code>&#39;websql&#39;</code> adapter, you can use <code>options.size</code> to request more than 5MB up-front, in order to avoid errors caused by reaching the storage limit on iOS/Safari. Details <a href="errors.html">here</a>.</li>
</ol>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span>
<span class="c1">// or</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;http://localhost:5984/dbname&#39;</span><span class="p">);</span></code></pre></div>

<p>Create a WebSQL-only Pouch (e.g. when using the <a href="https://github.com/lite4cordova/Cordova-SQLitePlugin">SQLite Plugin</a> for Cordova/PhoneGap):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">adapter</span> <span class="o">:</span> <span class="s1">&#39;websql&#39;</span><span class="p">});</span></code></pre></div>

<p>Create an in-memory Pouch (in Node):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">db</span> <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;memdown&#39;</span><span class="p">)});</span></code></pre></div>

<div id='delete_database'></div>

<p><a class='h2 anchor' href='#delete_database' name='delete_database'>Delete a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Delete database.</p>

<p><strong>Notes:</strong> With a remote CouchDB on Node, options are passed to <a href="https://github.com/mikeal/request">request</a>.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p>You can also delete a database using just the name:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">destroy</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<div id='create_document'></div>

<p><a class='h2 anchor' href='#create_document' name='create_document'>Create / update a document</a></p>

<h3>Using db.put()</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">docId</span><span class="p">],</span> <span class="p">[</span><span class="nx">docRev</span><span class="p">],</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create a new document or update an existing document. If the document already exists, you must specify its revision <code>_rev</code>, otherwise a conflict will occur.</p>

<p>There are some restrictions on valid property names of the documents. These are explained <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Special_Fields">here</a>.</p>

<h4>Example Usage:</h4>

<p>Create a new doc with an <code>_id</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Heroes&#39;</span>
<span class="p">},</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p>Like all methods, you can also use a promise:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Lady Stardust&#39;</span>
<span class="p">},</span> <span class="s1">&#39;myOtherDoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p>Update an existing doc using <code>_rev</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myOtherDoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">otherDoc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;Let&#39;s Dance&quot;</span>
  <span class="p">},</span> <span class="s1">&#39;myOtherDoc&#39;</span><span class="p">,</span> <span class="nx">otherDoc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>You can also include the <code>_id</code> and <code>_rev</code> directly in the document:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myOtherDoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">otherDoc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;myOtherDoc&#39;</span><span class="p">,</span>
    <span class="nx">_rev</span><span class="o">:</span> <span class="nx">otherDoc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Be My Wife&#39;</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// on error</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// on success</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
<span class="p">}</span></code></pre></div>

<h3>Using db.post()</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create a new document and let PouchDB generate an <code>_id</code> for it.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Ziggy Stardust&#39;</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h3>Example Response:</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span> <span class="o">:</span> <span class="s2">&quot;8A2C3761-FFD5-4770-9B8C-38C33CED300A&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span> <span class="o">:</span> <span class="s2">&quot;1-d3a8e0e5aa7c8fff0c376dac2d8a4007&quot;</span>
<span class="p">}</span></code></pre></div>

<p><strong>Put vs. post</strong>: The basic rule of thumb is: <code>put()</code> new documents with an <code>_id</code>, <code>post()</code> new documents without an <code>_id</code>.</p>

<div id='fetch_document'></div>

<p><a class='h2 anchor' href='#fetch_document' name='fetch_document'>Fetch a document</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Retrieves a document, specified by <code>docId</code>.</p>

<h3>Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
<li><code>options.rev</code>: Fetch specific revision of a document. Defaults to winning revision (see <a href="http://guide.couchdb.org/draft/conflicts.html">the CouchDB guide</a>).</li>
<li><code>options.revs</code>: Include revision history of the document.</li>
<li><code>options.revs_info</code>: Include a list of revisions of the document, and their availability.</li>
<li><code>options.open_revs</code>: Fetch all leaf revisions if <code>open_revs=&quot;all&quot;</code> or fetch all leaf revisions specified in <code>open_revs</code> array. Leaves will be returned in the same order as specified in input array.</li>
<li><code>options.conflicts</code>: If specified, conflicting leaf revisions will be attached in <code>_conflicts</code> array.</li>
<li><code>options.attachments</code>: Include attachment data.</li>
<li><code>options.local_seq</code>: Include sequence number of the revision in the database.</li>
<li><code>options.ajax</code>: An object of options to be sent to the ajax requester. In Node they are sent verbatim to <a href="https://github.com/mikeal/request">request</a> with the exception of:

<ul>
<li><code>options.ajax.cache</code>: Appends a random string to the end of all HTTP GET requests to avoid them being cached on IE. Set this to <code>true</code> to prevent this happening.</li>
</ul></li>
</ul>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Rock and Roll Heart&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
<span class="p">}</span></code></pre></div>

<div id='delete_document'></div>

<p><a class='h2 anchor' href='#delete_document' name='delete_document'>Delete a document</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Or:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">docRev</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Deletes the document. <code>doc</code> is required to be a document with at least an <code>_id</code> and a <code>_rev</code> property. Sending the full document will work as well.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span>
  <span class="c1">// or:</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">_rev</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3>With Promises:</h3>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="c1">//errors</span>
<span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-9AF304BE281790604D1D8A4B0F4C9ADB&quot;</span>
<span class="p">}</span></code></pre></div>

<div id='batch_create'></div>

<p><a class='h2 anchor' href='#batch_create' name='batch_create'>Create/update a batch of documents</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">(</span><span class="nx">docs</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Create, update or delete multiple documents. The <code>docs</code> argument is an array of documents.</p>

<p>If you omit an <code>_id</code> parameter on a given document, the database will create a new document and assign the ID for you. To update a document, you must include both an <code>_id</code> parameter and a <code>_rev</code> parameter, which should match the ID and revision of the document on which to base your updates. Finally, to delete a document, include a <code>_deleted</code> parameter with the value <code>true</code>.</p>

<p><strong>Note</strong>: Previously <code>bulkDocs()</code> took an object with a key <code>docs</code> holding the array of documents. This is deprecated, but still works.</p>

<h4>Example Usage:</h4>

<p>Post some new docs and auto-generate the <code>_id</code>s:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">},</span>
  <span class="p">{</span><span class="nx">title</span> <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;06F1740A-8E8A-4645-A2E9-0D8A8C0C983A&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
    <span class="p">},</span> 
    <span class="p">{</span>
        <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
        <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;6244FB45-91DB-41E5-94FF-58C540E91844&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
    <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<h4>Bulk update/delete:</h4>

<p>Then you can update those same docs:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span> 
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;Velvet Underground&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;06F1740A-8E8A-4645-A2E9-0D8A8C0C983A&quot;</span><span class="p">,</span> 
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>  <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">artist</span> <span class="o">:</span> <span class="s1">&#39;David Bowie&#39;</span><span class="p">,</span>
    <span class="nx">_id</span>    <span class="o">:</span> <span class="s2">&quot;6244FB45-91DB-41E5-94FF-58C540E91844&quot;</span><span class="p">,</span> 
    <span class="nx">_rev</span>   <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p>Or delete them:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">bulkDocs</span><span class="p">([</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Lisa Says&#39;</span><span class="p">,</span> 
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;06F1740A-8E8A-4645-A2E9-0D8A8C0C983A&quot;</span><span class="p">,</span> 
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-84abc2a942007bee7cf55007cba56198&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="nx">title</span>    <span class="o">:</span> <span class="s1">&#39;Space Oddity&#39;</span><span class="p">,</span>
    <span class="nx">_deleted</span> <span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">_id</span>      <span class="o">:</span> <span class="s2">&quot;6244FB45-91DB-41E5-94FF-58C540E91844&quot;</span><span class="p">,</span> 
    <span class="nx">_rev</span>     <span class="o">:</span> <span class="s2">&quot;1-7b80fc50b6af7a905f368670429a757e&quot;</span>
  <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p><strong>Note:</strong> You can also specify a <code>new_edits</code> property on the options object that when set to <code>false</code> allows you to post and overwrite <a href="http://wiki.apache.org/couchdb/HTTP_Bulk_Document_API#Posting_Existing_Revisions">existing documents</a>. Normally only the replication algorithm needs to do this.</p>

<div id='batch_fetch'></div>

<p><a class='h2 anchor' href='#batch_fetch' name='batch_fetch'>Fetch a batch of documents</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Fetch multiple documents.  Deleted documents are only included if <code>options.keys</code> is specified.</p>

<h3>Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
<li><code>options.include_docs</code>: Include the document itself in each row in the <code>doc</code> field. Otherwise by default you only get the <code>_id</code> and <code>_rev</code> properties.

<ul>
<li><code>options.conflicts</code>: Include conflict information in the <code>_conflicts</code> field of a doc.</li>
<li><code>options.attachments</code>: Include attachment data.</li>
</ul></li>
<li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get documents with IDs in a certain range (inclusive/inclusive).</li>
<li><code>options.inclusive_end</code>: Include documents having an ID equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
<li><code>options.limit</code>: Maximum number of documents to return.</li>
<li><code>options.skip</code>: Number of docs to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
<li><code>options.descending</code>: Reverse the order of the output documents.</li>
<li><code>options.key</code>: Only return documents with IDs matching this string key.</li>
<li><code>options.keys</code>: Array of string keys to fetch in a single shot.

<ul>
<li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
<li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
<li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>&quot;deleted&quot;:true</code> in the <code>value</code> property.</li>
<li>The row for a nonexistent document will just contain an <code>&quot;error&quot;</code> property with the value <code>&quot;not_found&quot;</code>.</li>
<li>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</li>
</ul></li>
</ul>

<p><strong>Notes:</strong> For pagination, <code>options.limit</code> and <code>options.skip</code> are also available, but the same performance concerns as in CouchDB apply. Use the <a href="http://docs.couchdb.org/en/latest/couchapp/views/pagination.html">startkey/endkey pattern</a> instead. <code>total_rows</code> is the total number of documents in the database.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">allDocs</span><span class="p">({</span><span class="nx">include_docs</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
      <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span><span class="p">,</span>
      <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;Sound and Vision&quot;</span>
    <span class="p">},</span>
   <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
   <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
   <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
   <span class="p">}</span>
 <span class="p">}]</span>
<span class="p">}</span></code></pre></div>

<div id='changes'></div>

<p><a class='h2 anchor' href='#changes' name='changes'>Listen to database changes</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span></code></pre></div>

<p>A list of changes made to documents in the database, in the order they were made.
It returns an object with the method <code>cancel()</code>, which you call if you don&#39;t want to listen to new changes anymore. </p>

<p>It is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>&#39;change&#39;</code> event on each document change, a <code>&#39;complete&#39;</code> event when all the changes have been processed, and an <code>&#39;error&#39;</code> event when an error occurs. In addition to the <code>&#39;change&#39;</code> event, any change will also emit a <code>&#39;create&#39;</code>, <code>&#39;update&#39;</code>, or <code>&#39;delete&#39;</code> event.</p>

<h3>Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
<li><code>options.include_docs</code>: Include the associated document with each change.

<ul>
<li><code>options.conflicts</code>: Include conflicts.</li>
<li><code>options.attachments</code>: Include attachments.</li>
</ul></li>
<li><code>options.descending</code>: Reverse the order of the output documents.</li>
<li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates.</li>
<li><code>options.since</code>: Start the results from the change immediately after the given sequence number, you can also pass &#39;now&#39; if you want only new changes.</li>
<li><code>options.live</code>: Uses the  <code>_longpoll_</code> feed. </li>
<li><code>options.limit</code>: Limit the number of results to this number.</li>
<li><code>options.style</code>: Specifies how many revisions are returned in the changes array. The default, <code>&#39;main_only&#39;</code>, will only return the current &quot;winning&quot; revision; <code>&#39;all_docs&#39;</code> will return all leaf revisions (including conflicts and deleted former conflicts).</li>
<li><code>options.view</code>: Specify a view function to act as a filter. Documents counted as &quot;passed&quot; for a view filter if a map function emits at least one record for them.</li>
<li><code>options.returnDocs</code>: Is available for non http databases and defaults to true, passing <code>false</code> prevents the changes feed from keeping all the documents in memory, in other words complete always has an empty results array, and the <code>change</code> event is the only way to get the event. Useful for large change sets where otherwise you would run out of memory.</li>
<li><code>options.batch_size</code>: Only available for http databases, this configures how many changes to fetch at a time. Increasing this can reduce the number of requests made. Default is 25.</li>
</ul>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">since</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
  <span class="nx">live</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">change</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span>

<span class="nx">changes</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span><span class="s2">&quot;somestuff&quot;</span><span class="p">,</span>
  <span class="s2">&quot;seq&quot;</span><span class="o">:</span><span class="mi">21</span><span class="p">,</span>
  <span class="s2">&quot;changes&quot;</span><span class="o">:</span><span class="p">[{</span>
    <span class="s2">&quot;rev&quot;</span><span class="o">:</span><span class="s2">&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;</span>
  <span class="p">}],</span>
  <span class="s2">&quot;doc&quot;</span><span class="o">:</span><span class="p">{</span>
    <span class="s2">&quot;title&quot;</span><span class="o">:</span><span class="s2">&quot;Ch-Ch-Ch-Ch-Changes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="s2">&quot;someDocId&quot;</span><span class="p">,</span>
    <span class="s2">&quot;_rev&quot;</span><span class="o">:</span><span class="s2">&quot;1-8e6e4c0beac3ec54b27d1df75c7183a8&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;results&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A6157A5EA545C99B00FF904EEF05FD9F&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;otherdoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-3753476B70A49EA4D8C9039E7B04254C&quot;</span>
    <span class="p">}]</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;</span><span class="p">,</span>
    <span class="s2">&quot;seq&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s2">&quot;changes&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-A8BC08745E62E58830CA066D99E5F457&quot;</span>
    <span class="p">}]</span>
  <span class="p">}]</span>
<span class="p">}</span></code></pre></div>

<p><strong>Note:</strong></p>

<ul>
<li>The <code>&#39;complete&#39;</code> event only fires when you aren&#39;t doing live changes. With live changes, use the <code>&#39;uptodate&#39;</code> event instead.</li>
<li>The <code>changes()</code> method was not an event emitter before PouchDB 2.2.0, and instead of the <code>&#39;change&#39;</code> and <code>&#39;complete&#39;</code> events it took <code>complete</code> and <code>onChange</code> function options. This is deprecated and could be removed in PouchDB version 3.</li>
<li>The <code>&#39;since&#39;</code>option formally took &#39;latest&#39; but has been changed to &#39;now&#39; to keep consistency with CouchDB, &#39;latest&#39; is deprecated but will still work to ensure backwards compatibility.</li>
</ul>

<div id='replication'></div>

<p><a class='h2 anchor' href='#replication' name='replication'>Replicate a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>Replicate data from <code>source</code> to <code>target</code>.  Both the <code>source</code> and <code>target</code> can be a PouchDB instance or a string representing a CouchDB database URL or the name of a local PouchDB database. If <code>options.live</code> is <code>true</code>, then this will track future changes and also replicate them automatically. This method returns an object with the method <code>cancel()</code>, which you call if you want to cancel live replication.</p>

<p>Replication is an event emiter like <code>changes()</code> and emits the <code>&#39;complete&#39;</code>, <code>&#39;uptodate&#39;</code>, <code>&#39;change&#39;</code> and <code>&#39;error&#39;</code> events.</p>

<h3>Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
<li><code>options.filter</code>: Reference a filter function from a design document to selectively get updates.</li>
<li><code>options.query_params</code>: Query params sent to the filter function.</li>
<li><code>options.doc_ids</code>: Only replicate docs with these ids.</li>
<li><code>options.live</code>: If <code>true</code>, starts subscribing to future changes in the <code>source</code> database and continue replicating them.</li>
<li><code>options.since</code>: Replicate changes after the given sequence number.</li>
<li><code>options.create_target</code>: Create target database if it does not exist. Only for server replications.</li>
<li><code>options.batch_size</code>: Number of documents to process at a time. Defaults to 100. This affects the number of docs held in memory and the number sent at a time to the target server. You may need to adjust downward if targeting devices with low amounts of memory (e.g. phones) or if the documents are large in size (e.g. with attachments). If your documents are small in size, then increasing this number will probably speed replication up.</li>
<li><code>options.batches_limit</code>: Number of batches to process at a time. Defaults to 10. This (along wtih <code>batch_size</code>) controls how many docs are kept in memory at a time, so the maximum docs in memory at once would equal <code>batch_size</code> &times; <code>batches_limit</code>.</li>
</ul>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">replication</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle change</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle complete</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;uptodate&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle up-to-date</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle error</span>
  <span class="p">});</span>
  
<span class="nx">replication</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<p>There are also shorthands for replication given existing PouchDB objects. These behave the same as <code>PouchDB.replicate()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span>
<span class="c1">// or</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">replicate</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></div>

<p><strong>Notes:</strong></p>

<ul>
<li>The <code>&#39;complete&#39;</code> event only fires when you aren&#39;t doing live replication, or when live replication fails.</li>
<li>The <code>&#39;uptodate&#39;</code> event fires during live replication, when the target database is up-to-date and just idling, waiting for new changes.</li>
</ul>

<h4>Example Response:</h4>

<p>Example response in the <code>&#39;change&#39;</code> listener:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;doc_write_failures&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="s2">&quot;docs_read&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> 
  <span class="s2">&quot;docs_written&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> 
  <span class="s2">&quot;errors&quot;</span><span class="o">:</span> <span class="p">[],</span> 
  <span class="s2">&quot;last_seq&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> 
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="s2">&quot;start_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:23:12 GMT-0700 (PDT)&quot;</span>
<span class="p">}</span></code></pre></div>

<p>Example response in the <code>&#39;complete&#39;</code> listener:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;doc_write_failures&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> 
  <span class="s2">&quot;docs_read&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> 
  <span class="s2">&quot;docs_written&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> 
  <span class="s2">&quot;end_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:26:00 GMT-0700 (PDT)&quot;</span><span class="p">,</span> 
  <span class="s2">&quot;errors&quot;</span><span class="o">:</span> <span class="p">[],</span> 
  <span class="s2">&quot;last_seq&quot;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> 
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
  <span class="s2">&quot;start_time&quot;</span><span class="o">:</span> <span class="s2">&quot;Fri May 16 2014 18:26:00 GMT-0700 (PDT)&quot;</span><span class="p">,</span> 
  <span class="s2">&quot;status&quot;</span><span class="o">:</span> <span class="s2">&quot;complete&quot;</span>
<span class="p">}</span></code></pre></div>

<p><strong>Notes:</strong></p>

<ul>
<li>The response for server replications (via <code>options.server</code>) is slightly different. See the <a href="http://wiki.apache.org/couchdb/Replication">CouchDB replication documentation</a> for details.</li>
<li>The <code>&#39;live&#39;</code> option was formerly called <code>&#39;continuous&#39;</code>. You can still use <code>&#39;continuous&#39;</code> if you can spell it.</li>
<li>The replicate() method was not an event emitter before PouchDB 2.2.0, and instead of the <code>&#39;change&#39;</code> and <code>&#39;complete&#39;</code> events it took <code>complete</code> and <code>onChange</code> function options. This is deprecated and could be removed in PouchDB version 3.</li>
</ul>

<div id='sync'></div>

<p><a class='h2 anchor' href='#sync' name='sync'>Sync a database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">])</span></code></pre></div>

<p>Sync data from <code>src</code> to <code>target</code> and <code>target</code> to <code>src</code>. This is a convenience method for bidirectional data replication.</p>

<p>In other words, this code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">);</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">replicate</span><span class="p">(</span><span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;mydb&#39;</span><span class="p">);</span></code></pre></div>

<p>is equivalent to this code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">);</span></code></pre></div>

<h3>Options</h3>

<p>Please refer to <a href="api.html#replication">Replication</a> for documentation on options, as <code>sync()</code> is just a convenience method that entails bidirectional replication.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">sync</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="s1">&#39;mydb&#39;</span><span class="p">,</span> <span class="s1">&#39;http://localhost:5984/mydb&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">live</span><span class="o">:</span> <span class="kc">true</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle change</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle complete</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;uptodate&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle up-to-date</span>
  <span class="p">}).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle error</span>
  <span class="p">});</span>
  
<span class="nx">sync</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span> <span class="c1">// whenever you want to cancel</span></code></pre></div>

<p>There is also a shorthand for syncing given existing PouchDB objects. This behaves the same as <code>PouchDB.sync()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">sync</span><span class="p">(</span><span class="nx">remoteDB</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">]);</span></code></pre></div>

<p>For any further details, please further to <a href="api.html#replication">Replication</a>.</p>

<div id='save_attachment'></div>

<p><a class='h2 anchor' href='#save_attachment' name='save_attachment'>Save an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">]);</span></code></pre></div>

<p>Attaches a binary object to a document. Most of PouchDB&#39;s API deals with JSON, but if you&#39;re dealing with large binary data (such as PNGs), you may incur a performance or storage penalty if you simply include them as base64- or hex-encoded strings. In these cases, you can store the binary data as an attachment. For details, see the <a href="https://wiki.apache.org/couchdb/HTTP_Document_API#Attachments">CouchDB documentation on attachments</a>.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s2">&quot;It&#39;s a God awful small affair&quot;</span><span class="p">]);</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="nx">doc</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{})</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;otherdoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-068E73F5B44FEC987B51354DFC772891&quot;</span>
<span class="p">}</span></code></pre></div>

<p>Within Node, you must use a <code>Buffer</code> instead of a <code>Blob</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s2">&quot;It&#39;s a God awful small affair&quot;</span><span class="p">);</span></code></pre></div>

<p>For details, see the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Mozilla docs on <code>Blob</code></a> or the <a href="http://nodejs.org/api/buffer.html">Node docs on <code>Buffer</code></a>.  If you need a shim for older browsers that don&#39;t support the <code>Blob</code> constructor, you can use <a href="https://gist.github.com/nolanlawson/10340255">this one</a>.</p>

<h3>Save an inline attachment</h3>

<p>You can also inline attachments inside the document. In this case, the attachment data must be supplied as a base64-encoded string:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s1">&#39;_id&#39;</span><span class="o">:</span> <span class="s1">&#39;otherdoc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;title&#39;</span><span class="o">:</span> <span class="s1">&#39;Legendary Hearts&#39;</span><span class="p">,</span>
  <span class="s1">&#39;_attachments&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
       <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;TGVnZW5kYXJ5IGhlYXJ0cywgdGVhciB1cyBhbGwgYXBhcnQKT&quot;</span> <span class="o">+</span>
         <span class="s2">&quot;WFrZSBvdXIgZW1vdGlvbnMgYmxlZWQsIGNyeWluZyBvdXQgaW4gbmVlZA==&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>See <a href="http://wiki.apache.org/couchdb/HTTP_Document_API#Inline_Attachments">Inline Attachments</a>
on the CouchDB wiki for details.</p>

<div id='get_attachment'></div>

<p><a class='h2 anchor' href='#get_attachment' name='get_attachment'>Get an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Get attachment data.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;otherdoc&#39;</span><span class="p">,</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<p>In Node you get <code>Buffer</code>s, and in the browser you get <code>Blob</code>s.</p>

<h3>Inline attachments</h3>

<p>You can specify <code>attachments: true</code> to most read operations. The attachment data will then be included inlined in the resulting list of docs.</p>

<div id='delete_attachment'></div>

<p><a class='h2 anchor' href='#delete_attachment' name='delete_attachment'>Delete an attachment</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="nx">docId</span><span class="p">,</span> <span class="nx">attachmentId</span><span class="p">,</span> <span class="nx">rev</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Delete an attachment from a doc.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">removeAttachment</span><span class="p">(</span><span class="s1">&#39;otherdoc&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;text&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;2-068E73F5B44FEC987B51354DFC772891&#39;</span><span class="p">,</span>
                    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="s2">&quot;rev&quot;</span><span class="o">:</span> <span class="s2">&quot;3-1F983211AB87EFCCC980974DFC27382F&quot;</span>
<span class="p">}</span></code></pre></div>

<div id='query_database'></div>

<p><a class='h2 anchor' href='#query_database' name='query_database'>Query the database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">fun</span><span class="p">,</span> <span class="p">[</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Retrieves a view, which allows you to perform more complex queries on PouchDB. The <a href="http://docs.couchdb.org/en/latest/couchapp/views/intro.html">CouchDB documentation for map/reduce</a> applies to PouchDB.</p>

<p>Since views perform a full scan of all documents, this method may be slow, unless you first save your view in a design document.</p>

<h3>Options</h3>

<p>All options default to <code>false</code> unless otherwise specified.</p>

<ul>
<li><code>fun</code>: Map/reduce function, which can be one of the following: 

<ul>
<li>A map function by itself (no reduce).</li>
<li>A full CouchDB-style map/reduce object: <code>{map : ..., reduce: ...}</code>.</li>
<li>The name of a view in an existing design document (e.g. <code>&#39;myview&#39;</code> or <code>&#39;mydesigndoc/myview&#39;</code>).</li>
</ul></li>
<li><code>options.reduce</code>: Reduce function, or the string name of a built-in function: <code>&#39;_sum&#39;</code>, <code>&#39;_count&#39;</code>, or <code>&#39;_stats&#39;</code>.  Defaults to <code>false</code> (no reduce).

<ul>
<li>Tip: if you&#39;re not using a built-in, <a href="http://youtu.be/BKQ9kXKoHS8?t=865s">you&#39;re probably doing it wrong</a>.</li>
<li>On local databases, <code>rereduce</code> will always be <code>false</code> (since it&#39;s single-node).</li>
</ul></li>
<li><code>options.include_docs</code>: Include the document in each row in the <code>doc</code> field.

<ul>
<li><code>options.conflicts</code>: Include conflicts in the <code>_conflicts</code> field of a doc.</li>
<li><code>options.attachments</code>: Include attachment data.</li>
</ul></li>
<li><code>options.startkey</code> &amp; <code>options.endkey</code>: Get rows with keys in a certain range (inclusive/inclusive).</li>
<li><code>options.inclusive_end</code>: Include rows having a key equal to the given <code>options.endkey</code>. Default: <code>true</code>.</li>
<li><code>options.limit</code>: Maximum number of rows to return.</li>
<li><code>options.skip</code>: Number of rows to skip before returning (warning: poor performance on IndexedDB/LevelDB!).</li>
<li><code>options.descending</code>: Reverse the order of the output rows.</li>
<li><code>options.key</code>: Only return rows matching this key.</li>
<li><code>options.keys</code>: Array of keys to fetch in a single shot.

<ul>
<li>Neither <code>startkey</code> nor <code>endkey</code> can be specified with this option.</li>
<li>The rows are returned in the same order as the supplied <code>keys</code> array.</li>
<li>The row for a deleted document will have the revision ID of the deletion, and an extra key <code>&quot;deleted&quot;:true</code> in the <code>value</code> property.</li>
<li>The row for a nonexistent document will just contain an <code>&quot;error&quot;</code> property with the value <code>&quot;not_found&quot;</code>.</li>
</ul></li>
<li><code>options.group</code>: True if you want the reduce function to group results by keys, rather than returning a single result. Defaults to <code>false</code>. </li>
<li><code>options.group_level</code>: Number of elements in a key to group by, assuming the keys are arrays. Defaults to the full length of the array.</li>
<li><code>options.stale</code>: One of <code>&#39;ok&#39;</code> or <code>&#39;update_after&#39;</code>.  Only applies to saved views. Can be one of:

<ul>
<li>unspecified (default): Returns the latest results, waiting for the view to build if necessary.</li>
<li><code>&#39;ok&#39;</code>: Returns results immediately, even if they&#39;re out-of-date.</li>
<li><code>&#39;update_after&#39;</code>: Returns results immediately, but kicks off a build afterwards.</li>
</ul></li>
</ul>

<p>For details, see the <a href="http://wiki.apache.org/couchdb/HTTP_view_API#Querying_Options">CouchDB query options documentation</a>.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="nx">map</span><span class="o">:</span> <span class="nx">map</span><span class="p">},</span> <span class="p">{</span><span class="nx">reduce</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;0B3358C1-BA4B-4186-8795-9024203EB7DD&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Cony Island Baby&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;otherdoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Legendary Hearts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;828124B9-3973-4AF3-9DFD-A94CE4544005&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Lisa Says&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Rock and Roll Heart&quot;</span><span class="p">,</span>
    <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="kc">null</span>
  <span class="p">}],</span>
  <span class="s2">&quot;total_rows&quot;</span> <span class="o">:</span> <span class="mi">4</span>
<span class="p">}</span></code></pre></div>

<p><strong>Note:</strong> <code>total_rows</code> is the total number of possible results in the view.</p>

<h4>Complex keys</h4>

<p>You can also use <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Complex_Keys">complex keys</a> for fancy ordering:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// sort by last name, first name, and age</span>
  <span class="nx">emit</span><span class="p">([</span><span class="nx">doc</span><span class="p">.</span><span class="nx">lastName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">firstName</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">age</span><span class="p">]);</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Bowie&quot;</span><span class="p">,</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span> <span class="mi">67</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;dylan&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Dylan&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">,</span> <span class="mi">72</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;younger_dylan&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Dylan&quot;</span><span class="p">,</span> <span class="s2">&quot;Jakob&quot;</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;hank_the_third&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span> <span class="s2">&quot;Hank&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">]</span>
    <span class="p">},</span> <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span>  <span class="o">:</span> <span class="s2">&quot;hank&quot;</span><span class="p">,</span>
      <span class="s2">&quot;key&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span> <span class="s2">&quot;Hank&quot;</span><span class="p">,</span> <span class="mi">91</span><span class="p">]</span>
    <span class="p">}],</span>
  <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></div>

<p><strong>Tips:</strong> </p>

<ul>
<li>CouchDB sorts objects last, so <code>{startkey: [&#39;Williams&#39;], endkey: [&#39;Williams&#39;, {}]}</code> would return all people with the last name <code>&#39;Williams&#39;</code>.</li>
<li><code>group_level</code> can be very helpful when working with complex keys.  In the example above, you can use <code>{group_level: 1}</code> to group by last name, or <code>{group_level: 2}</code> to group by last and first name.</li>
</ul>

<h4>Linked documents</h4>

<p>PouchDB fully supports <a href="https://wiki.apache.org/couchdb/Introduction_to_CouchDB_views#Linked_documents">linked documents</a>. Use them to join two types of documents together, by simply adding an <code>_id</code> to the emitted value:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// join artist data to albums</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;album&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span><span class="nx">_id</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">artistId</span><span class="p">,</span> <span class="nx">albumYear</span> <span class="o">:</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">year</span><span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">map</span><span class="p">,</span> <span class="p">{</span><span class="nx">include_docs</span> <span class="o">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{});</span></code></pre></div>

<h4>Example response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
    <span class="s2">&quot;offset&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;rows&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_hunkydory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Hunky Dory&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_hunkydory&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1971</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Low&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_low&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1977</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;doc&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;bowie&quot;</span><span class="p">,</span>
                <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-fdb234b78904a5c8293f2acf4be70d44&quot;</span><span class="p">,</span>
                <span class="s2">&quot;age&quot;</span><span class="o">:</span> <span class="mi">67</span><span class="p">,</span>
                <span class="s2">&quot;firstName&quot;</span><span class="o">:</span> <span class="s2">&quot;David&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lastName&quot;</span><span class="o">:</span> <span class="s2">&quot;Bowie&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_spaceoddity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;key&quot;</span><span class="o">:</span> <span class="s2">&quot;Space Oddity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="p">{</span>
                <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;album_spaceoddity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;albumYear&quot;</span><span class="o">:</span> <span class="mi">1969</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="s2">&quot;total_rows&quot;</span><span class="o">:</span> <span class="mi">3</span>
<span class="p">}</span></code></pre></div>

<h4>Closures</h4>

<p>If you pass a function to <code>db.query</code> and give it the <code>emit</code> function as the second argument, then you can use a closure. (Otherwise we have to use <code>eval()</code> to bind <code>emit</code>.)</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="c1">// BAD! will throw error</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span>

<span class="c1">// will be fine</span>
<span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">emit</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span></code></pre></div>

<p>You don&#39;t actuallly have to call them by those names, though:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">myId</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span><span class="p">;</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">thisIs</span><span class="p">,</span> <span class="nx">awesome</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">thisIs</span><span class="p">.</span><span class="nx">_id</span> <span class="o">===</span> <span class="nx">myId</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">awesome</span><span class="p">(</span><span class="nx">thisIs</span><span class="p">);</span> 
  <span class="p">}</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">});</span></code></pre></div>

<p>Note that closures are only supported by local databases with temporary views.</p>

<div id='view_cleanup'></div>

<p><a class='h2 anchor' href='#view_cleanup' name='view_cleanup'>View cleanup</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Cleans up any stale map/reduce indexes.</p>

<p>As design docs are deleted or modified, their associated index files (in CouchDB) or companion databases (in local PouchDBs) continue to take up space on disk. <code>viewCleanup()</code> removes these unnecessary index files.</p>

<p>See <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html#views-cleanup">the CouchDB documentation on view cleanup</a> for details.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">viewCleanup</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;ok&quot;</span> <span class="o">:</span> <span class="s2">&quot;true&quot;</span>
<span class="p">}</span></code></pre></div>

<div id='database_information'></div>

<p><a class='h2 anchor' href='#database_information' name='database_information'>Get database information</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span></code></pre></div>

<p>Get information about a database.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">info</span><span class="p">)</span> <span class="p">{</span> <span class="p">})</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;db_name&quot;</span><span class="o">:</span> <span class="s2">&quot;test&quot;</span><span class="p">,</span>
  <span class="s2">&quot;doc_count&quot;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="s2">&quot;update_seq&quot;</span><span class="o">:</span> <span class="mi">5</span>
<span class="p">}</span></code></pre></div>

<p><strong>Response object:</strong></p>

<ul>
<li><code>db_name</code> is the name of the database you gave when you called <code>new PouchDB()</code>, and also the unique identifier for the database.</li>
<li><code>doc_count</code> is the total number of non-deleted documents in the database.</li>
<li><code>update_seq</code> is the sequence number of the database.  It starts at 0 and gets incremented every time a document is added or modified.</li>
</ul>

<div id='compaction'></div>

<p><a class='h2 anchor' href='#compaction' name='compaction'>Compact the database</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">compact</span><span class="p">([</span><span class="nx">options</span><span class="p">],</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Triggers a compaction operation for <code>db</code> on the local or remote database. This reduces the database&#39;s size by removing unused and old data. If a <code>callback</code> function is specified, Pouch checks compaction status at regular intervals and fires the callback upon completion. Consult the <a href="http://couchdb.readthedocs.org/en/latest/maintenance/compaction.html">compaction section of CouchDB&#39;s maintenance documentation</a> for more detail about database compaction.</p>

<ul>
<li><code>options.interval</code>: Number of milliseconds Pouch waits before asking again if compaction is already done. Defaults to 200.</li>
</ul>

<div id='revisions_diff'></div>

<p><a class='h2 anchor' href='#revisions_diff' name='revisions_diff'>Document revisions diff</a></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">(</span><span class="nx">diff</span><span class="p">,</span> <span class="p">[</span><span class="nx">callback</span><span class="p">])</span></code></pre></div>

<p>Given a set of document/revision IDs, returns the subset of those that do not correspond
to revisions stored in the database. Primarily used in replication.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">revsDiff</span><span class="p">({</span>
  <span class="nx">myDoc1</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;1-b2e54331db828310f3c772d6e042ac9c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;</span>
  <span class="p">]</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">diffs</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span></code></pre></div>

<h4>Example Response:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;myDoc1&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;missing&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2-3a24009a9525bde9e4bfa8a99046b00d&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<div id='events'></div>

<p><a class='h2 anchor' href='#events' name='events'>Events</a></p>

<p>PouchDB is an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter">event emitter</a> and will emit a <code>&#39;created&#39;</code> event when a database is created. A <code>&#39;destroyed&#39;</code> event is emitted when a database is destroyed.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;created&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenver a db is created.</span>
<span class="p">});</span>
<span class="nx">PouchDB</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;destroyed&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">dbName</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called whenver a db is destroyed.</span>
<span class="p">});</span></code></pre></div>

<div id='defaults'></div>

<p><a class='h2 anchor' href='#defaults' name='defaults'>Default settings</a></p>

<p>If you find yourself using the same constructor options repeatedly,
you can simplify your code with <code>PouchDB.defaults()</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">option1</span><span class="o">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
  <span class="nx">option2</span><span class="o">:</span> <span class="s1">&#39;value&#39;</span>
<span class="p">});</span></code></pre></div>

<p>The returned object is a constructor function that works the same as <code>PouchDB</code>, except that whenever you invoke it (e.g. with <code>new</code>), the given options will be passed in by default.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">MyMemPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">db</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;memdown&#39;</span><span class="p">)</span>
<span class="p">});</span>
<span class="c1">// MemDOWN-backed Pouch (in Node)</span>
<span class="kd">var</span> <span class="nx">MyMemPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyMemPouch</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">MyPrefixedPouch</span> <span class="o">=</span> <span class="nx">PouchDB</span><span class="p">.</span><span class="nx">defaults</span><span class="p">({</span>
  <span class="nx">prefix</span><span class="o">:</span> <span class="s1">&#39;/path/to/my/db/&#39;</span>
<span class="p">});</span>
<span class="c1">// db will be named &#39;/path/to/my/db/dbname&#39;, useful for LevelDB</span>
<span class="kd">var</span> <span class="nx">myPrefixedPouch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyPrefixedPouch</span><span class="p">(</span><span class="s1">&#39;dbname&#39;</span><span class="p">);</span></code></pre></div>

<p>Note the special constructor option <code>prefix</code>, which appends a prefix to the database name
and can be helpful for URL-based or file-based LevelDOWN path names.</p>

<p>All <a href="#create_database">constructor options</a> are supported. Default options can still be overriden individually.</p>

<div id='plugins'></div>

<p><a class='h2 anchor' href='#plugins' name='plugins'>Plugins</a></p>

<p>Writing a plugin is easy! The API is:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="nx">methodName</span><span class="o">:</span> <span class="nx">myFunction</span>
<span class="p">});</span></code></pre></div>

<p>This will add the function as a method of all databases with the given method name.  It will always be called in context, so that <code>this</code> always refers to the database object.</p>

<p>We also offer a <a href="https://github.com/pouchdb/plugin-seed">PouchDB Plugin Seed project</a>, which is the fastest way to get started writing, building and testing your very own plugin.</p>

<h4>Example Usage:</h4>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PouchDB</span><span class="p">.</span><span class="nx">plugin</span><span class="p">({</span>
  <span class="nx">sayMyName</span> <span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">info</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">info</span><span class="p">)</span>   <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;My name is &#39;</span> <span class="o">+</span> <span class="nx">info</span><span class="p">.</span><span class="nx">db_name</span><span class="p">);</span>
    <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span>
<span class="k">new</span> <span class="nx">PouchDB</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">).</span><span class="nx">sayMyName</span><span class="p">();</span> <span class="c1">// prints &quot;My name is foobar&quot;</span></code></pre></div>

        <div>

    </div>

  </div>

</article>


    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb' target='_blank'>
              <div class="icon icon-twitter"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/rvagg/node-levelup' target='_blank'>
              <div class="icon icon-leveldb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-github"></div>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-travis"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/' target='_blank'>
              <div class="icon icon-couchdb"></div>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com' target='_blank'>
              <div class="icon icon-saucelabs"></div>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/daleharvey/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb">Source</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/daleharvey/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  </body>
</html>
